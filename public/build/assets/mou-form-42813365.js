const m=document.getElementById("is-old-data").value=="1",s=document.getElementById("is-form-create").value=="1",u=document.getElementById("nilai-kontrak"),d=document.getElementById("hasil-transfer-bank"),f=document.getElementById("selisih");m&&s==!1&&(Dropzone.autoDiscover=!1);$(function(){["letter_receipt_date","mou_start","mou_end","pks_start","pks_end","document_start","document_end"].forEach(e=>{$(`input[name=${e}_display]`).datepicker({dateFormat:"d MM yy",altFormat:"yy-mm-dd",altField:`input[name=${e}_value]`,dayNamesMin:["Min","Sen","Sel","Rab","Kam","Jum","Sab"],monthNames:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"]})}),$('a[data-toggle="pill"]').on("shown.bs.tab",function(e){e.target.getAttribute("data-target")==="#tab-document"?$("#btn-submit").show():$("#btn-submit").hide()}),$("#btn-submit").on("click",g),s||(ketikNominal(u),ketikNominal(d))});if(m&&s==!1)var l=new Dropzone(".dropzone",{url:`${window.location.origin}/dashboard/mou/upload-mou-file`,acceptedFiles:".jpeg,.jpg,.png,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",paramName:"file",maxFiles:10,maxFilesize:10,addRemoveLinks:!0,autoQueue:!1,headers:{"X-CSRF-TOKEN":window._token},success:function(e,t){t.status==!0&&($("#form-mou").append(`<input type="hidden" name="files['${t.data.uniq}']" value="${t.data.name}" required>`),$("#form-mou").append(`<input type="hidden" name="files_size['${t.data.uniq}']" value="${t.data.size}" required>`))},error:function(e,t){if(console.log(e),console.log(t),typeof t=="string")notifySwal(!1,`Error File ${e.name} - ${t}`),this.options.removedfile(e);else throw notifySwal(!1,"Terjadi Kesalahan Server : Gagal Upload File "+e.name),new Error("Terjadi Kesalahan Server")},removedfile:function(e){e.previewElement!=null&&e.previewElement.parentNode!=null&&e.previewElement.parentNode.removeChild(e.previewElement),$("#form-mou").find('input[value="'+e.name+'"]').remove()},addedfiles(){console.log("event addedfiles"),console.log(this.files)},init:function(){let e=document.getElementById("old-files").value;e!==""&&(e=JSON.parse(e),console.log(e),e.forEach((t,n)=>{let a={name:t.filename,size:t.size};this.options.addedfile.call(this,a),a.previewElement.classList.add("dz-complete"),$("#form-mou").append(`<input type="hidden" name="files[${n}]" value="${t.filename}" required>`),n==e.length-1&&this.emit("complete",a)}))}});function p(e){return new Promise((t,n)=>{if(typeof l>"u")return n("Dropzone not found");function a(o){o===e&&(l.off("success",a),l.off("error",i),t())}function i(o,r){o===e&&(l.off("success",a),l.off("error",i),n(r))}l.on("success",a),l.on("error",i),l.processFile(e)})}async function g(){var e=document.getElementById("form-mou");if(e.checkValidity()==!1){var t=e.querySelectorAll(":invalid");for(var n of t)return console.error(n),n.focus(),!1}if(showLoading(!0),m&&s==!1){const a=l.getAcceptedFiles();if(a.length>0)try{await Promise.all(a.map(i=>p(i))),console.log("Proses Upload File Selesai")}catch(i){return console.error("Gagal mengunggah file:",i),showLoading(!1),!1}}console.log("Submit"),e.submit()}window.ketikNominal=async e=>{if(u.value!=""&&d.value!=""){let t=parseInt(u.value.split(".").join("")),n=parseInt(d.value.split(".").join("")),a=t-n,i=a<0;f.value=c(a.toString(),i)}else f.value="";e.value=await c(e.value)};function c(e,t=!1){var n=e.replace(/[^,\d]/g,"").toString(),a=n.split(","),i=a[0].length%3,o=a[0].substr(0,i),r=a[0].substr(i).match(/\d{3}/gi);return r&&(o+=(i?".":"")+r.join(".")),o=a[1]!=null?o+","+a[1]:o,o?t?"-"+o:o:""}
